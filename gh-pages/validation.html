

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Validation &mdash; lovely.pyrest 0.0.2 documentation</title>
    
    <link rel="stylesheet" href="_static/lovelydoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="lovely.pyrest 0.0.2 documentation" href="index.html" />
    <link rel="prev" title="Creating Services" href="service.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="service.html" title="Creating Services"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">lovely.pyrest 0.0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
        
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Validation</a><ul>
<li><a class="reference internal" href="#schema-validation">Schema Validation</a></li>
<li><a class="reference internal" href="#validators">Validators</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="service.html"
                        title="previous chapter">Creating Services</a></p>
    <div id="searchbox">
      <h3>Quick search</h3>
        <form class="search" action="search.html" method="get">
          <div class="searchfield">
            <input type="text" name="q" />
            <input type="submit" value="" />
          </div>
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
        <p class="searchtip" style="font-size: 90%">
        Enter search terms or a module, class or function name.
        </p>
    </div>
        </div>
      </div>
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="validation">
<h1>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h1>
<p>Lovely PyRest provides two ways of validation. On the one hand you can use
schema validation using validictory. On the other hand you can implement
custom validators as functions to be more flexible.
Both ways can be combined.</p>
<div class="section" id="schema-validation">
<h2>Schema Validation<a class="headerlink" href="#schema-validation" title="Permalink to this headline">¶</a></h2>
<p>This is an example how to validate the <cite>query</cite>-Parameter and the request body:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">lovely.pyrest.service</span> <span class="kn">import</span> <span class="n">Service</span>

<span class="n">article</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;article&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&#39;/article&#39;</span><span class="p">)</span>

<span class="n">schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;body&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;object&quot;</span><span class="p">,</span>
        <span class="s">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;string&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;object&quot;</span><span class="p">,</span>
        <span class="s">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;string&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="nd">@article.post</span><span class="p">(</span><span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Save an article &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;stored&#39;</span><span class="p">:</span> <span class="s">&#39;ok&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Performing a POST request without any body or GET-Parameter fails and a json
error gets returned:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;/article&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">res</span><span class="o">.</span><span class="n">status</span>
<span class="go">400 Bad Request</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">print_json</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
<span class="go">{</span>
<span class="go">    &quot;errors&quot;: [</span>
<span class="go">        {</span>
<span class="go">            &quot;description&quot;: &quot;Required field &#39;id&#39; is missing&quot;,</span>
<span class="go">            &quot;location&quot;: &quot;query&quot;</span>
<span class="go">        },</span>
<span class="go">        {</span>
<span class="go">            &quot;description&quot;: &quot;No JSON object could be decoded&quot;,</span>
<span class="go">            &quot;location&quot;: &quot;body&quot;</span>
<span class="go">        }</span>
<span class="go">    ],</span>
<span class="go">    &quot;status&quot;: &quot;error&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
<p>For validation the <cite>query</cite> and <cite>body</cite> properties are used as seperate schemas.
The <cite>query</cite> schema is used for validating the GET-Parameter and the <cite>body</cite>
schema is used for validating the request body.
It&#8217;s not necessary to define both of them.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you define a <cite>query</cite> schema it&#8217;s important that the type is <cite>object</cite>,
because the GET-Parameter will be converted to a dictionary before they
get validated.
For the <cite>body</cite> schema it&#8217;s ok to use <cite>array</cite>.</p>
</div>
<p>For schema validation <a class="reference external" href="https://github.com/sunlightlabs/validictory">Validictory</a> is used.
Check the documentation to learn how to define schemas: <a class="reference external" href="http://validictory.readthedocs.org/en/latest/">Validictory Documentation</a>.</p>
</div>
<div class="section" id="validators">
<h2>Validators<a class="headerlink" href="#validators" title="Permalink to this headline">¶</a></h2>
<p>This example shows how to implement <cite>validators</cite> as functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">lovely.pyrest.service</span> <span class="kn">import</span> <span class="n">Service</span>

<span class="n">article</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;article&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&#39;/article&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">validate_query</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check if the id field is set &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">:</span>
        <span class="n">request</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;query&#39;</span><span class="p">,</span>
                           <span class="s">&#39;Parameter `id` is missing&#39;</span><span class="p">)</span>
        <span class="n">request</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="mi">400</span>


<span class="nd">@article.get</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">validate_query</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;status&#39;</span><span class="p">:</span> <span class="s">&#39;success&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>The <cite>validator</cite> function gets called by <cite>lovely.pyrest</cite> and passes the incoming
request as parameter.
The <cite>validator</cite> just has to add one or more errors if validation fails.
It&#8217;s possible to use multiple validators.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/article&#39;</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">res</span><span class="o">.</span><span class="n">status</span>
<span class="go">400 Bad Request</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">print_json</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
<span class="go">{</span>
<span class="go">    &quot;errors&quot;: [</span>
<span class="go">        {</span>
<span class="go">            &quot;description&quot;: &quot;Parameter `id` is missing&quot;,</span>
<span class="go">            &quot;location&quot;: &quot;query&quot;</span>
<span class="go">        }</span>
<span class="go">    ],</span>
<span class="go">    &quot;status&quot;: &quot;error&quot;</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="service.html" title="Creating Services"
             >previous</a> |</li>
        <li><a href="index.html">lovely.pyrest 0.0.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Lovely Systems GmbH.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>